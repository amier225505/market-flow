<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>فلاش الموبايل — صفحة ويب</title>
  <style>
    :root{--bg:#fff;--fg:#000}
    html,body{height:100%;margin:0;font-family:Tahoma,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--fg)}
    .app{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;box-sizing:border-box}
    h1{margin:0 0 12px;font-size:20px}
    p.small{margin:6px 0 18px;color:#444;font-size:14px}
    .controls{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
    button{appearance:none;border:0;padding:14px 18px;border-radius:12px;font-size:16px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.12)}
    .btn-white{background:#fff;color:#000}
    .btn-black{background:#000;color:#fff}
    .big-toggle{width:220px}
    .screen{flex:1;display:flex;align-items:center;justify-content:center;width:100%}
    .hint{position:fixed;left:12px;top:12px;background:rgba(0,0,0,.12);padding:8px 10px;border-radius:10px;font-size:13px}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="hint" id="statusHint">الوضع: شاشة</div>
  <div class="app">
    <h1>فلاش الموبايل — صفحة ويب</h1>
    <p class="small">هذه الصفحة تحاكي فلاش الموبايل: إما تشغيل كاميرا (إن كان يدعم المصباح) أو استخدام شاشة بيضاء شديدة الإضاءة.</p>

    <div class="controls">
      <button id="screenBtn" class="btn-white big-toggle">تشغيل شاشة ساطعة</button>
      <button id="screenDarkBtn" class="btn-black">شاشة قاتمة (قفل ضوء)</button>
      <button id="torchBtn" class="btn-white">تشغيل مصباح الكاميرا (إذا وجد)</button>
      <button id="fullscreenBtn" class="btn-white">تحويل لملء الشاشة</button>
    </div>

    <div class="screen" id="screenArea" style="width:100%"></div>

    <p class="small">ملاحظات: لتشغيل مصباح الكاميرا يحتاج متصفح يدعم الوصول إلى الكاميرا (غالبًا Chrome على Android) وصفحة تعمل عبر HTTPS أو ملف محلي مع إذن الكاميرا. إن لم يعمل المصباح فاستعمل زر "شاشة ساطعة".</p>
  </div>

  <script>
    const screenBtn = document.getElementById('screenBtn');
    const screenDarkBtn = document.getElementById('screenDarkBtn');
    const torchBtn = document.getElementById('torchBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const screenArea = document.getElementById('screenArea');
    const statusHint = document.getElementById('statusHint');

    let wakeLock = null;
    let stream = null; // media stream for torch
    let track = null;
    let torchOn = false;

    async function requestWakeLock() {
      try{
        if('wakeLock' in navigator){
          wakeLock = await navigator.wakeLock.request('screen');
        }
      }catch(e){ /* لا نكسر التطبيق لو فشل */ }
    }

    async function releaseWakeLock(){
      try{ if(wakeLock){ await wakeLock.release(); wakeLock=null } } catch(e){}
    }

    function setScreenMode(bright=true){
      releaseTorchIfAny();
      document.documentElement.style.setProperty('--bg', bright? '#ffffff':'#000000');
      document.documentElement.style.setProperty('--fg', bright? '#000000':'#ffffff');
      statusHint.textContent = 'الوضع: شاشة' + (bright? ' — ساطعة':' — قاتمة');
      if(bright) requestWakeLock(); else releaseWakeLock();
      torchOn = false;
    }

    async function tryEnableTorch(){
      // حاول الحصول على كاميرا خلفية واستخدام خاصية torch إن وجدت
      try{
        // اطلب كاميرا خلفية
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: 'environment' } } });
        track = stream.getVideoTracks()[0];
        const cap = track.getCapabilities ? track.getCapabilities() : {};
        if(cap.torch){
          await track.applyConstraints({ advanced: [{ torch: true }] });
          torchOn = true;
          statusHint.textContent = 'الوضع: مصباح الكاميرا — شغال';
          // اوقف شاشة الساطعة لنوفر طاقة
          document.documentElement.style.setProperty('--bg', '#000000');
          document.documentElement.style.setProperty('--fg', '#ffffff');
          await requestWakeLock();
        } else {
          // fallback: لو الموبايل لا يدعم torch استخدم الشاشة الساطعة
          stopStream();
          alert('عذرًا: هذا المتصفح/الجهاز لا يدعم التحكم بمصباح الكاميرا. سيتم تشغيل الشاشة الساطعة بدلاً من ذلك.');
          setScreenMode(true);
        }
      }catch(err){
        // لو الاذن مرفوض أو غير متاح
        stopStream();
        console.warn(err);
        alert('لم نتمكن من الوصول للكاميرا. تأكد من إعطاء الإذن أو استخدم زر "شاشة ساطعة".');
      }
    }

    function stopStream(){
      try{ if(track) track.stop(); }catch(e){}
      try{ if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; track=null } }catch(e){}
      torchOn=false;
      statusHint.textContent = 'الوضع: شاشة';
    }

    async function releaseTorchIfAny(){
      if(track){
        try{ await track.applyConstraints({ advanced: [{ torch: false }] }); }catch(e){}
      }
      stopStream();
    }

    screenBtn.addEventListener('click', ()=> setScreenMode(true));
    screenDarkBtn.addEventListener('click', ()=> setScreenMode(false));

    torchBtn.addEventListener('click', async ()=>{
      if(torchOn) { // إطفاء
        try{
          if(track) await track.applyConstraints({ advanced: [{ torch: false }] });
        }catch(e){}
        stopStream();
      } else {
        await tryEnableTorch();
      }
    });

    fullscreenBtn.addEventListener('click', async ()=>{
      try{
        if(!document.fullscreenElement){
          await document.documentElement.requestFullscreen();
        } else {
          await document.exitFullscreen();
        }
      }catch(e){console.warn(e)}
    });

    // Clean up when الصفحة تُغلق
    window.addEventListener('beforeunload', ()=>{
      releaseWakeLock();
      stopStream();
    });

    // وضع افتراضي: شاشة ساطعة
    setScreenMode(true);
  </script>
</body>
</html>
